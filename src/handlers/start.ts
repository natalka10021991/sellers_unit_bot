import { Context } from "grammy";
import { userRepository } from "../database/user-repository.js";

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
 */
export async function handleStart(ctx: Context): Promise<void> {
  const user = ctx.from;
  if (!user) return;

  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  userRepository.findOrCreate(user.id, user.username || null, user.first_name);

  const welcomeMessage = `
üëã <b>–ü—Ä–∏–≤–µ—Ç!</b>

–Ø –ø–æ–º–æ–≥—É –ø–æ—Å—á–∏—Ç–∞—Ç—å <b>–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ WB</b> –∏ Ozon

üìä <b>–ß—Ç–æ —è —É–º–µ—é:</b>
‚Ä¢ —Å—á–∏—Ç–∞—é —á–∏—Å—Ç—É—é –ø—Ä–∏–±—ã–ª—å
‚Ä¢ —É—á–∏—Ç—ã–≤–∞—é –∫–æ–º–∏—Å—Å–∏–∏, –ª–æ–≥–∏—Å—Ç–∏–∫—É –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã
‚Ä¢ –ø–æ–∫–∞–∑—ã–≤–∞—é, –≤—ã–≥–æ–¥–µ–Ω –ª–∏ —Ç–æ–≤–∞—Ä

üéÅ <b>–£ —Ç–µ–±—è –µ—Å—Ç—å 5 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤!</b>

–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å /calculate —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç.
`.trim();

  await ctx.reply(welcomeMessage, {
    parse_mode: "HTML",
    reply_markup: {
      inline_keyboard: [
        [{ text: "üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä–∂—É", callback_data: "start_calculation" }],
        [{ text: "‚ÑπÔ∏è –ü–æ–º–æ—â—å", callback_data: "help" }],
      ],
    },
  });
}

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
 */
export async function handleHelp(ctx: Context): Promise<void> {
  const helpMessage = `
üìñ <b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º</b>

<b>1. –ù–∞—á–Ω–∏ —Ä–∞—Å—á–µ—Ç</b>
–ù–∞–∂–º–∏ /calculate –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä–∂—É"

<b>2. –í–≤–µ–¥–∏ –¥–∞–Ω–Ω—ã–µ:</b>
‚Ä¢ üí∞ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å ‚Äî —Å–∫–æ–ª—å–∫–æ —Ç—ã –ø–ª–∞—Ç–∏—à—å –∑–∞ —Ç–æ–≤–∞—Ä
‚Ä¢ üè∑ –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ ‚Äî —Ü–µ–Ω–∞ –Ω–∞ Wildberries
‚Ä¢ üìä –ö–æ–º–∏—Å—Å–∏—è WB ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–±—ã—á–Ω–æ 15-25%)
‚Ä¢ üöö –õ–æ–≥–∏—Å—Ç–∏–∫–∞ ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ WB
‚Ä¢ üì¶ –•—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–∫–ª–∞–¥–µ

<b>3. –ü–æ–ª—É—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</b>
‚Ä¢ –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Å –µ–¥–∏–Ω–∏—Ü—ã
‚Ä¢ –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ %
‚Ä¢ ROI (—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/start ‚Äî –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
/calculate ‚Äî –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
/status ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
/help ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

<b>–í–æ–ø—Ä–æ—Å—ã?</b> –ü–∏—à–∏ @—Ç–≤–æ–π_username
`.trim();

  await ctx.reply(helpMessage, {
    parse_mode: "HTML",
    reply_markup: {
      inline_keyboard: [
        [{ text: "üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä–∂—É", callback_data: "start_calculation" }],
      ],
    },
  });
}

